@using SecureJournal.Core.Domain
@inject ISecureJournalAppService JournalApp

<div class="sj-nav-shell">
    <div class="brand-panel">
        <div class="brand-kicker">Secure Journal</div>
    </div>

    <nav class="sj-nav" aria-label="Primary navigation">
        <div class="sj-nav-main">
            <NavLink class="sj-nav-link" href="projects" Match="NavLinkMatch.Prefix">
                My Projects
            </NavLink>
            @if (_showAdminLinks)
            {
                <NavLink class="sj-nav-sub-link" href="admin/projects/create">
                    Create project
                </NavLink>
                <NavLink class="sj-nav-sub-link sj-nav-sub-link-child" href="admin/groups/create">
                    Create group
                </NavLink>
            }
            <NavLink class="sj-nav-link" href="journal">
                New Journal Entry
            </NavLink>
            <NavLink class="sj-nav-link" href="audit">
                Audit Search
            </NavLink>
            <NavLink class="sj-nav-link" href="exports">
                Exports
            </NavLink>
            @if (_showAdminLinks)
            {
                <NavLink class="sj-nav-link" href="admin/projects">
                    Project Management
                </NavLink>
                <NavLink class="sj-nav-link" href="admin/groups">
                    Group Management
                </NavLink>
                <NavLink class="sj-nav-link" href="admin/users">
                    User Memberships
                </NavLink>
                <NavLink class="sj-nav-link" href="admin/user-accounts">
                    User Accounts
                </NavLink>
            }
            <NavLink class="sj-nav-link" href="login">
                My Settings
            </NavLink>
        </div>
    </nav>
</div>

@code {
    private bool _showAdminLinks;

    protected override async Task OnParametersSetAsync()
    {
        if (!await JournalApp.HasCurrentUserAsync())
        {
            _showAdminLinks = false;
            return;
        }

        _showAdminLinks = (await JournalApp.GetCurrentUserAsync()).Role == AppRole.Administrator;
    }
}
